<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>70精选信息</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../js/qs/qs.common.new.css" />
		<!--<script type="text/javascript" src="../../js/vue/vue.min.js"></script>
		<script type="text/javascript" src="../../js/vue/vue-router.min.js"></script>
		<!--<script type="text/javascript" src="../../components_vue/App.js"></script>-->
		<style>
			.mui-table-view {
				background-color: #EEEEEE;
			}
			
			.mui-table-view:before {
				height: 0;
			}
			
			.imgmsg {
				max-width: 45%;
				margin: 0 auto;
				display: table;
				padding-top: 50px;
			}
			
			.mui-table-view:after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 0;
				height: 0px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #c8c7cc;
			}
			
			.read-color {
				color: #8f8f94;
			}
			
			.mui-badge {
				padding: 5px 5px;
				margin-left: -15px;
				font-size: 10px;
				line-height: 1.4;
				position: absolute;
				top: 10px;
				left: 60px;
				background: red;
				border-radius: 50px;
			}
			
			.cus-badge-box {
				position: relative;
			}
			
			.mui-table-view-chevron .mui-table-view-cell>a:not(.mui-btn) {
				margin-right: -70px;
			}
			
			.cus-time {
				margin-right: 10px;
				font-size: 12px;
				float: right;
				color: #8f8f94;
			}
			
			.mui-table-view-cell>a:not(.mui-btn) {
				padding: 12px 20px;
				background-color: #fff;
			}
			
			.cus-title {
				color: #353535;
				line-height: 24px;
			}
			
			.mui-ellipsis-10 {
				display: -webkit-box;
				overflow: hidden;
				white-space: normal!important;
				text-overflow: ellipsis;
				word-wrap: break-word;
				-webkit-line-clamp: 10;
				-webkit-box-orient: vertical;
			}
			
			.mui-navigate-right:after,
			.mui-push-right:after {
				right: 10px;
				content: '\e583';
				color: #36C5CD;
			}
			
			.doctor {
				font-size: 12px;
			}
			
			.mui-ellipsis-3 {
				overflow: hidden;
				white-space: normal;
				text-overflow: ellipsis;
				display: -webkit-box;
				-webkit-box-orient: vertical;
			}
			
			.inchat {
				position: absolute;
				top: 0;
				z-index: 999;
				width: 100%;
			}
			
			.mui-content>.mui-table-view:first-child {
				margin-top: 0px;
			}
			
			.tableDIV {
				border-top: 0px solid #dddddd;
				border-right: 1px solid #dddddd;
				border-bottom: 1px solid #dddddd;
				background-color: #FFFFFF;
				text-align: center;
				height: 60px;
			}
			
			#messageUL:after {
				height: 0px;
			}
			
			.mui-table-view:after {
				height: 1px;
			}
			
			.mingxi {
				background-color: #44cfd4;
			}
			
			.mui-content-padded {
				margin: 0;
				margin-top: 8px;
			}
			
			.mui-card .mui-control-content {
				padding: 10px;
			}
			
			.mui-control-content {
				/*height: 300px;*/
			}
			
			.mui-segmented-control {
				border: 0;
				border-bottom: 1px solid #d9d9d9;
				height: 60px;
			}
			
			.mui-segmented-control .mui-control-item.mui-active {
				background: none;
				color: #44cfd4;
				border-bottom: 2px solid;
				font-weight: bold;
			}
			
			.mui-segmented-control .mui-control-item {
				color: #666666;
				border-left: 0;
			}
			
			.uptab {
				background: #FFFFFF;
			}
			
			.mui-segmented-control .mui-control-item {
				line-height: 60px;
			}
			
			.no_red {
				display: none !important;
			}
			
			.mui-badgenum {
				font-size: 10px;
				line-height: 1;
				display: inline-block;
				padding: 3px 3px;
				color: #FFFFFF;
				border-radius: 100px;
				background-color: red;
				width: 20px;
				position: absolute;
				top: 10px;
			}
			
			.wutu {
				text-align: center;
				padding-top: 1.8rem;
				background: transparent;
			}
			
			.mui-card-header.mui-card-media .mui-media-body {
				margin: 0;
			}
			
			.mui-card {
				border-radius: 5px;
			}
			
			.QStitle {
				font-size: 14px;
				color: #4D4D4D;
				font-weight: bold;
			}
			
			.QStime {
				font-size: 12px !important;
				color: #999999;
				margin-top: 12px;
			}
			
			.mui-card-header:after {
				height: 0;
			}
			
			.mui-card-content img {
				width: 97%;
				min-height: 3.8rem;
			}
			
			.mui-card-content {
				padding-left: 10px;
			}
			
			.QScontent {
				font-size: 12px !important;
				color: #4D4D4D;
				line-height: 17px;
				padding-top: 10px;
			}
			
			.mui-card-footer .mui-card-link {
				color: #36C5CD;
			}
		</style>
	</head>

	<body>
		<div class="mui-content" >
			<div class="mui-control-content mui-active" id="news">
				<div class=" mui-scroll-wrapper ">
					<div id="refreshContainer">
					<div id="wrapper01" class="wrapper">
						<div id="scroller" class="scroller">
							<ul class="mui-table-view" id="messageUL">
								<!--<div id="refreshContainer">-->
									<!--<div id="wrapper01" class="wrapper" style="bottom: 2px;">
										<ul id="scroller" class="scroller" style="margin: 0; padding: 0;">-->

											<div class="mui-card" v-for="item in items">
												<div class="mui-card-header mui-card-media">
													<div class="mui-media-body">
														<div class="QStitle">{{item.title}}</div>
														<p class="QStime">{{item.time}}</p>
													</div>
												</div>
												<div class="mui-card-content">
													<img :src="item.cover" alt="">
													<p class="mui-ellipsis-3 QScontent">{{item.instruction}}</p>
												</div>
												<div class="mui-card-footer mui-navigate-right" :data-guid="item.guid" @tap="open_detail(item)">
													<a class="mui-card-link">查看详情</a>
												</div>
											</div>

										<!--</ul>
									</div>
								</div>-->
							</ul>
						</div>
					</div>
					</div> 
				</div>
			</div>
		</div>
	</body>
	<script src="../../js/muinew/mui.min.js"></script>

	<script type="text/javascript" src="../../js/mui.min.js"></script>
	<script type="text/javascript" src="../../js/app.js"></script>
	<script type="text/javascript" src="../../js/constants.js"></script>
	<script type="text/javascript" src="../../js/jquery-3.1.1.min.js"></script>

	<script type="text/javascript" src="../../plugs/moment/moment.min.js"></script>
	<script type="text/javascript" src="../../js/art/template-web.js"></script>
	<script type="text/javascript" src="../../js/qs/qs.art.extend.js"></script>
	<script type="text/javascript" src="../../js/qs/qs.template.js"></script>
	<script type="text/javascript" src="../../js/iscroll/iscroll-probe.js"></script>
	<script type="text/javascript" src="../../js/qs/qs.iscroll.js"></script>
	<script type="text/javascript" src="../../js/immersed.js"></script>
	<script type="text/javascript" src="../../js/json_time.js"></script>
	<script type="text/javascript" src="../../js/vue/vue.min.js"></script>
	<script type="text/javascript" src="../../js/vue/vue-router.min.js"></script>
	<!--<script type="text/javascript" src="../../js/qs/qs.immersed.js" ></script>-->

	<script>
		var wrapper01;
		var vm = new Vue({
			el: '#news',
			data: {
				items: [] //列表信息流数据
			},
			created: function() {},
			methods: {

			}
		});
		$(".mui-control-content").css("height", (screenHeight - 50));
		var titleNView = returnstyleTitle('message_xiangqing_withVue.html', '资讯详情');
		QS_notificationurl = serverAddress + '/api/selected/app/list';
		mui.plusReady(function() {

			var currentView = plus.webview.currentWebview();
			currentView.show('slide-in-right', 200);
			plus.nativeUI.closeWaiting();

			document.addEventListener('plusready', function() {
				console.log("QS_Immersed-UserAgent: " + navigator.userAgent);
			}, false);

			var immersed = 0;
			var ms = (/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
			if(ms && ms.length >= 3) {
				immersed = parseFloat(ms[2]);
			}
			window.immersed = immersed;

			if(!immersed) {
				return;
			}

			$(".mui-control-content").css("height", (screenHeight - 50));
//			$("#messageUL").css("height", (screenHeight + 2000));
			init()

		});

		function open_detail(item) { //触发子窗口变更新闻详情
			mui.openWindow({
				url: "../../geren_message/info_any_xiangqing_withComponents.html",
				id: "info_any_xiangqing_withComponents.html",
				styles: returnstyleTitle("info_any_xiangqing_withComponents.html", "70精选详情"),
				extras: {
					dataId: item.guid,
				}
			});
		}
		//下拉上拉方法
		function processConfimAction(myScroll) {
			var sussess = function(data) {
				console.log("70推送列表" + JSON.stringify(data));
				if(data.result == "success") {
					if(data.data) {
						if(myScroll.page == 1 && data.data.length == 0) {
							$("#messageUL").html('<p><img class="imgmsg" src="../images/no_data/1-01.png" data-preview-src="" data-preview-group="1"></p>');
						} else if(data.data.length != 0) {
							console.log(myScroll.page);
							if(myScroll.page == 1) {
								vm.items = convert(data.data);
								myScroll.page = myScroll.page + 1;
								myScroll.upFlag = true
								myScroll.refresh();
							} else {
								if(data.data.length == myScroll.limit) {

									myScroll.page = myScroll.page + 1;
									myScroll.upFlag = true
								} else {
									myScroll.upFlag = false
								}
								vm.items = vm.items.concat(convert(data.data));
								myScroll.refresh();
							}

						} else {
							myScroll.upFlag = false
						}
					}

				} else {
					mui.toast(data.msg);
				}
			};
			commonHttpUtils2(QS_notificationurl + "?page=" + myScroll.page + "&limit=" + myScroll.limit, "get", "", sussess, error);
		}

		var init = function() {
			wrapper01 = $.initIscroll({
				id: "wrapper01",
				pullUpAction: processConfimAction,
				pullDownAction: processConfimAction,
				limit: 5
			});
			processConfimAction(wrapper01);
		}

		function convert(items) {
			var newItems = [];
			items.forEach(function(item) {
				var cover;
				cover = formatHttpString(item.cover);

				newItems.push({
					guid: item._id,
					title: item.name,
					instruction: item.introduction,
					cover: cover,
					time: getDate(item.createdOn),
					readcount: item.readcount
				});
			});
			return newItems;
		}
	</script>

</html>